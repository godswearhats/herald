
<!DOCTYPE html>
<html>
<head>
	<title>Armies</title>
	<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">
	<meta name="format-detection" content="telephone=no">
	<meta name="msapplication-tap-highlight" content="no">
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.css" />
	<script src="js/jquery-2.2.4.js"></script>
	<script src="js/jquery.mobile-1.4.5.js"></script>
	<script src="js/shared.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$("#new").on( "pagecontainerbeforehide", function( event, ui ) {
				alert("Bloop!")
				console.log(ui)
				herald.army = {
					'template': loadArmy(event.target.dataset.army),
					'name': $('#army-name').val(),
					'limit': $('#army-limit').val()
				}
			})
		})
	</script>
</head>

<body>

<!-- Header and footer -->
<div id="header" data-role="header">
	<a id="header-menu" href="#new" class="ui-btn ui-btn-icon-left ui-icon-bars ui-btn-icon-notext ui-corner-all ui-btn-inline">Menu</a>
	<h3 id="header-title">Elves</h3>
	<a id="header-action" href="#" class="ui-btn ui-btn-b ui-icon-plus ui-btn-icon-right ui-btn-icon-notext ui-corner-all ui-btn-inline">Add Unit</a>
</div>

<div id="footer" data-role="footer">
	<div id="navbar" data-role="navbar">
		<ul>
			<li><a href="#armies" class="ui-btn-active">Armies</a></li>
			<li><a href="#battles">Battles</a></li>
			<li><a href="#events">Events</a></li>
		</ul>
	</div>
</div>
<script type="text/javascript">
	$(function(){
		$( "[data-role='header'], [data-role='footer']" ).toolbar( {'theme': 'a'})
	})
	// Update the contents of the toolbars
	$(document).on('pagecontainerchange', function() {
			// TODO highlight buttons for navbar
	    var title = $('.ui-page-active').jqmData('title')
			if (title) {
				$('#header-title').text(title)
			}
			var action = $('.ui-page-active').jqmData('action')
			if (action) {
				$('#header-action').attr('href', action).show()
			}
			else {
				$('#header-action').hide()
			}
	})
</script>

<!-- #army-list: List of all the armies created -->
<div data-role="page" data-title="Armies" data-action="#new" id="army-list">
	<div role="main" class="ui-content">

    <ul data-role="listview" data-inset="true" data-divider-theme="a">
        <li data-role="list-divider">Elves <span class="ui-li-count">2</span></li>
        <li><a href="#build">Wet Coast 2250</a></li>
        <li><a href="#build">Dragon Rider 2000</a></li>
        <li data-role="list-divider">The Herd <span class="ui-li-count">1</span></li>
        <li><a href="#build">Joe's army</a></li>
    </ul>
	</div>
</div>

  <!-- #new: Create a new army -->
<div data-role="page" data-title="Create new army" id="new">
  <div role="main" class="ui-content">
    <form>
			<label for="army-name">Army name (optional)</label>
      <input name="army-name" id="army-name" value="" placeholder="e.g. Adepticon 2019" type="text">
			<label for="army-limit">Points Limit (optional)</label>
			<input name="army-limit" id="army-limit" value="" placeholder="2000" type="text">
    </form>
    <ul data-role="listview" data-inset="true">
      <li><a href="#build" class="build" data-army="elves">Elves <span class="ui-li-count">2</span></a></li>
      <li><a href="#build" class="build" data-army="herd">The Herd<span class="ui-li-count">1</span></a></li>
      <li><a href="#build" class="build" data-army="abyssal-dwarfs">Abyssal Dwarfs</a></li>
      <li><a href="#build" class="build" data-army="abyss">Forces of the Abyss</a></li>
      <li><a href="#build" class="build" data-army="dwarfs">Dwarfs</a></li>
      <li><a href="#build" class="build" data-army="dust">Empire of Dust</a></li>
      <li><a href="#build" class="build" data-army="basilea">Forces of Basilea</a></li>
      <li><a href="#build" class="build" data-army="nature">Forces of Nature</a></li>
      <li><a href="#build" class="build" data-army="goblins">Goblins</a></li>
      <li><a href="#build" class="build" data-army="men">Kingdoms of Men</a></li>
      <li><a href="#build" class="build" data-army="ogres">Ogres</a></li>
      <li><a href="#build" class="build" data-army="ratkin">Ratkin</a></li>
      <li><a href="#build" class="build" data-army="salamanders">Salamanders</a></li>
      <li><a href="#build" class="build" data-army="brotherhood">The Brotherhood</a></li>
      <li><a href="#build" class="build" data-army="rhordia">The League of Rhordia</a></li>
      <li><a href="#build" class="build" data-army="trident">Trident Realms</a></li>
      <li><a href="#build" class="build" data-army="kin">Twilight Kin</a></li>
      <li><a href="#build" class="build" data-army="undead">Undead</a></li>
      <li><a href="#build" class="build" data-army="varangur">Varangur</a></li>
    </ul>
	</div>
</div>

<!-- #build: actually build your army -->
<div data-role="page" id="build" data-action="#show-units">
	<div role="main" class="ui-content">
		<ul data-role="listview" id="army-entries">

		</ul>
	</div>
	<script type="text/javascript">
	$( "#build" ).on( "pagecontainershow", function( event, ui ) {
	  alert("Herald!");
		$.each(herald.army.units, function(number, entry) {
			var item = makeUnitStatsEntry(entry.name, herald.template.entries[entry.name].units[entry.unit])
			$('#army-entries').append(item)
		})
	});

	</script>
</div>

<!-- #unit-details: customize a given unit -->
<div data-role="page" id="unit-details">
	<div class="ui-content" role="main">
		<div id="unit-entry">
		</div>
	</div>
	<script type="text/javascript">
		var item = makeUnitStatsTable(herald.currentUnit.name + ' (' + herald.currentUnit.unit + ')', herald.currentUnit.stats)
		$('#unit-entry').append(item)
	</script>
</div>

<!-- #artifacts: list of magical artifacts -->
<div data-role="page" id="artifacts" data-theme="a">
	<div role="main" class="ui-content">
		<form class="ui-filterable">
				<input id="artifacts-autocomplete" data-type="search" placeholder="Search artifacts...">
		</form>
		<ul id="artifacts-choices" data-role="listview" data-filter="true" data-input="#artifacts-autocomplete" data-inset="true">

		</ul>

	</div>
	<script type="text/javascript">
	function makeArtifactEntry(name, entry) {
		var item = document.createElement('li')
		var anchor = document.createElement('a')
		$(anchor).text(name)
		$(anchor).attr('href', '#build')
		var points = document.createElement('span')
		$(points).addClass('ui-li-count')
		$(points).text(entry.points)
		anchor.appendChild(points)
		item.appendChild(anchor)
		return item
		// TODO add description and rules
	}
	$(function(){
		var artifacts = {}
		$.getJSON('data/artifacts.json', function(data) {
			$.each(data, function(name, entry) {
				var item = makeArtifactEntry(name, entry)
				$('#artifacts-choices').append(item)
			})
		})
	})
	</script>
</div>

<!-- #show-units: show the units for your army -->
<div data-role="page" id="show-units" data-title="Units">

  <div role="main" class="ui-content">

		<style>
		table {
			  border-collapse: collapse;
			}
			tr {
			  border: solid;
			  border-width: 1px 0;
			}
			tr:first-child {
			  border-top: none;
			}
			tr:last-child {
			  border-bottom: none;
			}
			th {
				text-align: center;
				font-size: 80%;
				padding-right: 10px;
			}
			td {
				text-align: center;
				font-weight: lighter;
				font-size: 80%;
				padding-right: 8px;

			}
			h2 {
				margin-top: 0px;
				margin-bottom: 0px;
			}
		</style>

		<form class="ui-filterable">
		    <input id="filter-units" data-type="search">
		</form>
    <div data-inset="true" data-filter="true" data-role="collapsibleset" data-input="#filter-units" id="unit-choices">
    </div>
		<script type="text/javascript">
			function makeUnitEntry(name, entry) {
				var item = document.createElement('div')
				var type = (entry.type >= 10)
					?	'Hero (' + types[entry.type - 10] + ')'
					:	types[entry.type]

				// expand if more than one unit choice (e.g. Troop, Regiment, Horde)
				var header = document.createElement('h2')
				header.innerHTML = name
				item.appendChild(header)
				item.setAttribute('data-role', 'collapsible')
				item.setAttribute('data-filtertext', name + ' ' + type)
				item.setAttribute('data-iconpos', 'right')
				item.setAttribute('data-inset', 'false')
				var unitSizes = document.createElement('ul')
				$.each(entry.units, function(unit, stats) {
					var unitChoice = makeUnitStatsEntry(name, unit, stats)
					unitSizes.appendChild(unitChoice)
				})
				item.appendChild(unitSizes)
				$(unitSizes).listview()
				$(item).collapsible()
				return item
			}

			$.each(herald.template, function(name, entry) {
				var item = makeUnitEntry(name, entry)
				$('#unit-choices').append(item)
			})
    </script>
	</div>

</div>

</body>

</html>
